<div class="container mt-4">
  <h2 class="mb-4">Bảng điều khiển</h2>

  <div class="row g-3">
    <div class="col-md-3">
      <div class="card text-white bg-primary card-stat" data-type="task" style="cursor: pointer;">
        <div class="card-body text-center">
          <h5 class="card-title">Nhiệm vụ</h5>
          <p class="display-6 fw-bold">12</p>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card text-white bg-success card-stat" data-type="project" style="cursor: pointer;">
        <div class="card-body text-center">
          <h5 class="card-title">Dự án</h5>
          <p class="display-6 fw-bold">5</p>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card text-white bg-danger card-stat" data-type="message" style="cursor: pointer;">
        <div class="card-body text-center">
          <h5 class="card-title">Tin nhắn</h5>
          <p class="display-6 fw-bold">5</p>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card text-white bg-warning card-stat" data-type="notification" style="cursor: pointer;">
        <div class="card-body text-center">
          <h5 class="card-title">Thông báo</h5>
          <p class="display-6 fw-bold">3</p>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-4">
    <!-- Biểu đồ -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header" id="chartTitle">
          Tiến độ nhiệm vụ
        </div>
        <div class="card-body">
          <canvas id="chart" height="200"></canvas>
        </div>
      </div>
    </div>

    <!-- Bảng dữ liệu thay đổi -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header" id="tableTitle">
          Nhiệm vụ gần đây
        </div>
        <div class="card-body" id="tableContent">
          <!-- Mặc định bảng nhiệm vụ gần đây -->
          <table class="table table-striped table-sm">
            <thead>
              <tr>
                <th>Tên nhiệm vụ</th>
                <th>Hạn</th>
                <th>Trạng thái</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Hoàn thiện báo cáo</td>
                <td>30/06/2025</td>
                <td><span class="badge bg-warning text-dark">Đang làm</span></td>
              </tr>
              <tr>
                <td>Kiểm tra hệ thống</td>
                <td>28/06/2025</td>
                <td><span class="badge bg-success">Hoàn thành</span></td>
              </tr>
              <tr>
                <td>Triển khai dự án A</td>
                <td>05/07/2025</td>
                <td><span class="badge bg-danger">Chưa bắt đầu</span></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  let chartInstance;

  const chartData = {
    task: {
      title: "Tiến độ nhiệm vụ",
      labels: ["Đang làm", "Hoàn thành", "Chưa bắt đầu", "Chậm tiến độ"],
      data: [5, 3, 2, 2],
      colors: ["#ffc107", "#28a745", "#6c757d", "#dc3545"],
      tableTitle: "Nhiệm vụ gần đây",
      tableHtml: `
        <table class="table table-striped table-sm">
          <thead>
            <tr>
              <th>Tên nhiệm vụ</th>
              <th>Hạn</th>
              <th>Trạng thái</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Hoàn thiện báo cáo</td>
              <td>30/06/2025</td>
              <td><span class="badge bg-warning text-dark">Đang làm</span></td>
            </tr>
            <tr>
              <td>Kiểm tra hệ thống</td>
              <td>28/06/2025</td>
              <td><span class="badge bg-success">Hoàn thành</span></td>
            </tr>
            <tr>
              <td>Triển khai dự án A</td>
              <td>05/07/2025</td>
              <td><span class="badge bg-danger">Chậm tiến độ</span></td>
            </tr>
            <tr>
              <td>Soạn tài liệu hướng dẫn</td>
              <td>10/07/2025</td>
              <td><span class="badge bg-secondary">Chưa bắt đầu</span></td>
            </tr>
          </tbody>
        </table>
      `
    },
    project: {
      title: "Tiến độ dự án",
      labels: ["Đang triển khai", "Đã hoàn thành", "Chưa khởi công", "Chậm tiến độ"],
      data: [2, 2, 1, 1],
      colors: ["#17a2b8", "#28a745", "#6c757d", "#dc3545"],
      tableTitle: "Dự án gần đây",
      tableHtml: `
        <table class="table table-striped table-sm">
          <thead>
            <tr>
              <th>Tên dự án</th>
              <th>Thời gian</th>
              <th>Trạng thái</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Dự án A</td>
              <td>01/06/2025 - 30/09/2025</td>
              <td><span class="badge bg-info text-dark">Đang triển khai</span></td>
            </tr>
            <tr>
              <td>Dự án B</td>
              <td>01/01/2025 - 31/03/2025</td>
              <td><span class="badge bg-success">Đã hoàn thành</span></td>
            </tr>
            <tr>
              <td>Dự án C</td>
              <td>01/08/2025 - 31/12/2025</td>
              <td><span class="badge bg-secondary">Chưa khởi công</span></td>
            </tr>
            <tr>
              <td>Dự án D</td>
              <td>01/05/2025 - 31/12/2025</td>
              <td><span class="badge bg-danger">Chậm tiến độ</span></td>
            </tr>
          </tbody>
        </table>
      `
    }
  };

  function renderChart(type) {
    const data = chartData[type];
    if (!data) return;

    document.getElementById("chartTitle").innerText = data.title;

    if (chartInstance) {
      chartInstance.destroy();
    }

    const ctx = document.getElementById("chart").getContext("2d");
    chartInstance = new Chart(ctx, {
      type: "doughnut",
      data: {
        labels: data.labels,
        datasets: [{
          data: data.data,
          backgroundColor: data.colors
        }]
      },
      options: {
        plugins: {
          legend: { position: "bottom" }
        }
      }
    });

    document.getElementById("tableTitle").innerText = data.tableTitle;
    document.getElementById("tableContent").innerHTML = data.tableHtml;
  }

  // Load chart nhiệm vụ ban đầu
  renderChart("task");

  document.querySelectorAll(".card-stat").forEach(card => {
    card.addEventListener("click", () => {
      const type = card.dataset.type;

      if (type === "message") {
        const dropdown = new bootstrap.Dropdown(document.getElementById("messageBtn"));
        dropdown.show();
      } else if (type === "notification") {
        const dropdown = new bootstrap.Dropdown(document.getElementById("notificationBtn"));
        dropdown.show();
      } else {
        renderChart(type);
      }
    });
  });
</script>
