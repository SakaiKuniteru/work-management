<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-4 col-lg-3 sidebar">
            <div class="d-flex align-items-center mb-4">
                <img src="/img/logo.png" alt="Logo" style="height: 32px; margin-right: 10px;">
                <h5 class="mb-0 fw-bold">Trung tâm tài khoản</h5>
            </div>

            <a href="/setting" class="nav-link mb-2" data-page="personal">
                <i class="fa fa-user"></i> Trang cá nhân
            </a>

            <p class="small text-muted mb-4">
                Quản lý phần cài đặt tài khoản và trải nghiệm kết nối trên các công nghệ của bạn.
            </p>

            <nav class="nav flex-column">
                <a href="/password-security" class="nav-link">
                    <i class="fa fa-shield-alt"></i> 
                    Mật khẩu và bảo mật
                </a>

                <a href="/information" class="nav-link">
                    <i class="fa fa-id-card"></i> 
                    Thông tin cá nhân
                </a>

                <a href="/logout" class="nav-link">
                    <i class="fa fa-sign-out-alt"></i> 
                    Đăng xuất
                </a>
            </nav>
        </div>

        <!-- Main content -->
        <div class="col-md-8 col-lg-9 p-5">
            <h4 class="fw-bold mb-3">Thông tin cá nhân</h4>
            <p class="text-muted">
                PQH sử dụng thông tin này để xác minh danh tính của bạn và bảo vệ cộng đồng của chúng tôi.
                Bạn là người quyết định những thông tin cá nhân nào sẽ hiển thị với người khác.
            </p>

            <div class="card mt-4">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item border-0 d-flex justify-content-between align-items-center card-link" onclick="openEditModal('email')">
                        <div>
                            <div class="fw-bold">Thông tin liên hệ</div>
                            <small class="text-muted">{{user.email}}, {{user.phoneNumber}}</small>
                        </div>
                        <i class="fa fa-chevron-right text-muted"></i>
                    </li>

                    <li class="list-group-item border-0 d-flex justify-content-between align-items-center" onclick="openBirthdayModal()">
                        <div>
                            <div class="fw-bold">Ngày sinh</div>
                            <small class="text-muted">{{user.formattedDateOfBirth}}</small>
                        </div>
                        <i class="fa fa-chevron-right text-muted"></i>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Modal chỉnh sửa Email/SĐT -->
        <div class="modal fade" id="editContactModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" style="max-width: 500px;">
                <div class="modal-content">
                    <div class="modal-header border-0">
                        <button type="button" class="btn btn-link text-dark p-0 me-2" onclick="backToInfoPage()">
                            <i class="fa fa-arrow-left fa-lg"></i>
                        </button>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body p-4">
                        <h5 class="fw-bold mb-3" id="editContactTitle">Chỉnh sửa Email</h5>
                         <p class="text-muted small">
                            Quản lý số di động và email để đảm bảo thông tin liên hệ của bạn chính xác và cập nhật.
                        </p>
                        <div class="mb-3">
                            <label id="contactLabel" class="form-label">Email</label>
                            <input type="text" class="form-control" id="contactInput" placeholder="">
                        </div>

                        <div class="text-center">
                            <button class="btn btn-primary w-100" onclick="openOtpModal()">
                                Lưu thay đổi
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal OTP -->
        <div class="modal fade" id="otpModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" style="max-width: 500px;">
                <div class="modal-content">
                    <div class="modal-header border-0">
                        <button type="button" class="btn btn-link text-dark p-0 me-2" onclick="backToEditModal()">
                            <i class="fa fa-arrow-left fa-lg"></i>
                        </button>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body p-4 text-center">
                        <h5 class="fw-bold mb-3">Xác thực OTP</h5>
                        <p class="text-muted small">
                            Nhập mã OTP đã được gửi đến số điện thoại hoặc email của bạn.
                        </p>
                        <input type="text" class="form-control mb-4 mt-3" placeholder="Nhập mã OTP">
                        <button class="btn btn-primary w-100">
                            Xác nhận
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal chỉnh sửa Ngày sinh -->
        <div class="modal fade" id="birthdayModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" style="max-width: 500px;">
                <div class="modal-content">
                    <div class="modal-header border-0">
                        <button type="button" class="btn btn-link text-dark p-0 me-2" onclick="closeBirthdayModal()">
                            <i class="fa fa-arrow-left fa-lg"></i>
                        </button>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body p-4">
                        <h5 class="fw-bold mb-3">Chỉnh sửa ngày sinh</h5>
                        <div class="mb-3">
                            <label class="form-label">Ngày sinh</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="birthdayInput" placeholder="dd/mm/yyyy">
                                <span class="input-group-text">
                                    <i class="fa fa-calendar"></i>
                                </span>
                            </div>
                        </div>

                        <button class="btn btn-primary w-100" onclick="saveBirthday()">
                            Lưu thay đổi
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.querySelectorAll('.nav-link').forEach(link => {
        const href = link.getAttribute('href');
        if (href && href !== '#') {
            const linkPath = new URL(href, window.location.origin).pathname;
            if (window.location.pathname === linkPath) {
                link.classList.add('active', 'text-primary');
            }
        }
    });

    let currentEditing = '';

    function openEditModal(type) {
        currentEditing = type;
        if (type === 'email') {
            document.getElementById('editContactTitle').textContent = 'Chỉnh sửa Email';
            document.getElementById('contactLabel').textContent = 'Email';
            document.getElementById('contactInput').placeholder = 'Nhập email mới';
        } else if (type === 'phone') {
            document.getElementById('editContactTitle').textContent = 'Chỉnh sửa Số điện thoại';
            document.getElementById('contactLabel').textContent = 'Số điện thoại';
            document.getElementById('contactInput').placeholder = 'Nhập số điện thoại mới';
        }
        var modal = new bootstrap.Modal(document.getElementById('editContactModal'));
        modal.show();
    }

    function openOtpModal() {
        var editModal = bootstrap.Modal.getInstance(document.getElementById('editContactModal'));
        if (editModal) editModal.hide();

        setTimeout(() => {
            var otpModal = new bootstrap.Modal(document.getElementById('otpModal'));
            otpModal.show();
        }, 300);
    }

    function backToEditModal() {
        var otpModal = bootstrap.Modal.getInstance(document.getElementById('otpModal'));
        if (otpModal) otpModal.hide();

        setTimeout(() => {
            var editModal = new bootstrap.Modal(document.getElementById('editContactModal'));
            editModal.show();
        }, 300);
    }

    function backToInfoPage() {
        var editModal = bootstrap.Modal.getInstance(document.getElementById('editContactModal'));
        if (editModal) editModal.hide();
    }

    document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('hidden.bs.modal', () => {
            document.body.classList.remove('modal-open');
            document.querySelectorAll('.modal-backdrop').forEach(e => e.remove());
        });
    });

    function openBirthdayModal() {
        var modal = new bootstrap.Modal(document.getElementById('birthdayModal'));
        modal.show();

        $('#birthdayInput').datepicker({
            format: 'dd/mm/yyyy',
            autoclose: true,
            todayHighlight: true,
            endDate: '0d'
        });
    }

    function closeBirthdayModal() {
        var modal = bootstrap.Modal.getInstance(document.getElementById('birthdayModal'));
        if (modal) modal.hide();
    }

    function saveBirthday() {
        let birthday = document.getElementById('birthdayInput').value;
        console.log("Ngày sinh mới:", birthday);
        closeBirthdayModal();
    }

</script>
