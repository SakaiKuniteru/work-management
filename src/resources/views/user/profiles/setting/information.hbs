<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-4 col-lg-3 sidebar">
            <div class="d-flex align-items-center mb-4">
                <img src="/img/logo.png" alt="Logo" style="height: 32px; margin-right: 10px;">
                <h5 class="mb-0 fw-bold">Trung tâm tài khoản</h5>
            </div>

            <a href="/setting" class="nav-link mb-2" data-page="personal" data-bs-toggle="tooltip" data-bs-placement="bottom">
                <i class="fa fa-user"></i> Trang cá nhân
            </a>

            <p class="small text-muted mb-4">
                Quản lý phần cài đặt tài khoản và trải nghiệm kết nối trên các công nghệ của bạn.
            </p>

            <nav class="nav flex-column">
                <a href="/password-security" class="nav-link" data-bs-toggle="tooltip" data-bs-placement="bottom">
                    <i class="fa fa-shield-alt"></i> 
                    Mật khẩu và bảo mật
                </a>

                <a href="/information" class="nav-link" data-bs-toggle="tooltip" data-bs-placement="bottom">
                    <i class="fa fa-id-card"></i> 
                    Thông tin cá nhân
                </a>

                <a href="#" class="nav-link" data-bs-toggle="tooltip" data-bs-placement="bottom">
                    <i class="fa fa-sign-out-alt"></i> 
                    Đăng xuất
                </a>
            </nav>
        </div>

        <!-- Content -->
        <div class="col-md-8 col-lg-9 p-4">
            <h4 class="fw-bold mb-3">Trang cá nhân</h4>
            <p class="text-muted">
                Quản lý thông tin trên trang cá nhân và dùng chung trên các dịch vụ của bạn.
            </p>

            <div class="card mt-3" style="cursor:pointer;" data-bs-toggle="modal" data-bs-target="#profileModal">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <img src="https://scontent.fhan4-4.fna.fbcdn.net/v/t39.30808-1/484895554_685047493862507_8119295966222777149_n.jpg?stp=dst-jpg_s480x480_tt6&_nc_cat=102&ccb=1-7&_nc_sid=1d2534&_nc_ohc=caectHl2dC0Q7kNvwFZpmTp&_nc_oc=AdlzuM-4EqEXpj0a8NXp2aWixsOMa7ZpPS2qwivLi7ymF5mUyALOjAifZ68WPVmObys&_nc_zt=24&_nc_ht=scontent.fhan4-4.fna&_nc_gid=M__aZzDE70gPFwVMlRlKMA&oh=00_AfM9gSvmddWNMOSpz9yshrMxON82RP6HQ6B8mB8Ec-M2fg&oe=6865EDD7"
                        class="rounded-circle me-3" 
                        style="width: 50px; height: 50px;" 
                        alt="Avatar" 
                        />

                        <div>
                            <div class="fw-bold">Phạm Quốc Huy</div>
                        </div>
                    </div>
                    <i class="fa fa-chevron-right text-muted"></i>
                </div>
            </div>
        </div>

        <!-- Profile Modal -->
        <div class="modal fade" id="profileModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" style="max-width: 500px;">
                <div class="modal-content">
                    <div class="modal-body text-center p-4">
                        <!-- Avatar lớn -->
                        <img src="https://scontent.fhan4-4.fna.fbcdn.net/v/t39.30808-1/484895554_685047493862507_8119295966222777149_n.jpg?stp=dst-jpg_s480x480_tt6&_nc_cat=102&ccb=1-7&_nc_sid=1d2534&_nc_ohc=caectHl2dC0Q7kNvwFZpmTp&_nc_oc=AdlzuM-4EqEXpj0a8NXp2aWixsOMa7ZpPS2qwivLi7ymF5mUyALOjAifZ68WPVmObys&_nc_zt=24&_nc_ht=scontent.fhan4-4.fna&_nc_gid=M__aZzDE70gPFwVMlRlKMA&oh=00_AfM9gSvmddWNMOSpz9yshrMxON82RP6HQ6B8mB8Ec-M2fg&oe=6865EDD7"
                        class="rounded-circle mb-3 mt-5" 
                        style="width: 100px; height: 100px;" 
                        alt="Avatar">

                        <h5 class="fw-bold mb-5">Phạm Quốc Huy</h5>

                        <div class="list-group text-start mt-5">
                            <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
                                onclick="openChildModal('editNameModal')">
                                Tên
                                <i class="fa fa-chevron-right"></i>
                            </button>

                            <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
                                onclick="openChildModal('editAvatarModal')">
                                Ảnh đại diện
                                <i class="fa fa-chevron-right"></i>
                            </button>
                        </div>

                        <button type="button" class="btn-close position-absolute top-0 end-0 m-3" data-bs-dismiss="modal"></button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Name Modal -->
        <div class="modal fade" id="editNameModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" style="max-width: 500px;">
                <div class="modal-content">
                    <div class="modal-header border-0">
                        <button type="button" class="btn btn-link text-dark p-0 me-2" onclick="openProfileModalFromChild()">
                            <i class="fa fa-arrow-left fa-lg"></i>
                        </button>
                        
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <h5 class="modal-title fw-bold text-center mb-4">Chỉnh sửa Họ và Tên</h5>

                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="fullNameInput" class="form-label">Họ và tên</label>
                            <input type="text" class="form-control mb-3" placeholder="Phạm Văn A">
                        </div>

                        <div class="mb-3">
                            <label for="fullNameInput" class="form-label">Bí Danh</label>
                            <input type="text" class="form-control mb-3" placeholder="A Hay Hóng">
                        </div>

                        <div class="text-center">
                            <button class="btn btn-primary w-25">
                                Lưu thay đổi
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Avatar Modal -->
        <div class="modal fade" id="editAvatarModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" style="max-width: 500px;">
                <div class="modal-content">
                    <div class="modal-header border-0">
                        <button type="button" class="btn btn-link text-dark p-0 me-2" onclick="openProfileModalFromChild()">
                            <i class="fa fa-arrow-left fa-lg"></i>
                        </button>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <h5 class="modal-title fw-bold mb-2 text-center">Chỉnh sửa ảnh đại diện</h5>

                    <div class="modal-body text-center">
                        <img src="https://scontent.fhan4-4.fna.fbcdn.net/v/t39.30808-1/484895554_685047493862507_8119295966222777149_n.jpg?stp=dst-jpg_s480x480_tt6&_nc_cat=102&ccb=1-7&_nc_sid=1d2534&_nc_ohc=caectHl2dC0Q7kNvwFZpmTp&_nc_oc=AdlzuM-4EqEXpj0a8NXp2aWixsOMa7ZpPS2qwivLi7ymF5mUyALOjAifZ68WPVmObys&_nc_zt=24&_nc_ht=scontent.fhan4-4.fna&_nc_gid=M__aZzDE70gPFwVMlRlKMA&oh=00_AfM9gSvmddWNMOSpz9yshrMxON82RP6HQ6B8mB8Ec-M2fg&oe=6865EDD7"
                        class="rounded-circle mb-5" 
                        style="width: 120px; height: 120px;" 
                        alt="Avatar">

                        <div class="mb-3 text-start">
                            <input type="file" id="avatarFileInput" class="form-control d-none">
                            <button type="button" class="edit-avatar-btn" onclick="document.getElementById('avatarFileInput').click();">
                                Chỉnh sửa ảnh đại diện
                            </button>
                        </div>

                        <div class="text-center">
                            <button class="btn btn-primary w-25">Lưu thay đổi</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.querySelectorAll('.nav-link').forEach(link => {
        const href = link.getAttribute('href');
        if (href && href !== '#') {
            const linkPath = new URL(href, window.location.origin).pathname;
            if (window.location.pathname === linkPath) {
                link.classList.add('active', 'text-primary');
            }
        }
    });

    function openChildModal(childModalId) {
        // Đóng profileModal trước
        var modal = bootstrap.Modal.getInstance(document.getElementById('profileModal'));
        if (modal) modal.hide();

        // Mở modal con sau 300ms
        setTimeout(() => {
            var childModal = new bootstrap.Modal(document.getElementById(childModalId));
            childModal.show();
        }, 300);
    }

    function openProfileModalFromChild() {
        // Đóng tất cả modal đang mở
        var openedModals = document.querySelectorAll('.modal.show');
        openedModals.forEach(m => {
            var inst = bootstrap.Modal.getInstance(m);
            if (inst) inst.hide();
        });

        // Mở lại modal profile sau 300ms
        setTimeout(() => {
            var modal = new bootstrap.Modal(document.getElementById('profileModal'));
            modal.show();
        }, 300);
    }

    // Dọn backdrop sau khi bất kỳ modal đóng
    document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('hidden.bs.modal', () => {
            document.body.classList.remove('modal-open');
            document.querySelectorAll('.modal-backdrop').forEach(e => e.remove());
        });
    });

</script>